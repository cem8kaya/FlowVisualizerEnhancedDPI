<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Callflow Visualizer - nDPI</title>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <!-- Design System & Layout -->
    <link rel="stylesheet" href="/css/design-system.css">
    <link rel="stylesheet" href="/css/layout.css">
    <link rel="stylesheet" href="/css/components.css">
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="app-sidebar" id="sidebar">
            <div class="sidebar-header">
                <i class="bi bi-diagram-3"></i> <span>FlowVisualizer</span>
            </div>
            <nav class="sidebar-nav">
                <a href="/" class="nav-item active">
                    <i class="bi bi-grid-1x2-fill"></i> Dashboard
                </a>
                <a href="/" class="nav-item">
                    <i class="bi bi-list-task"></i> Jobs
                </a>
                <a href="/sessions.html" class="nav-item">
                    <i class="bi bi-activity"></i> Sessions
                </a>
                <a href="/volte.html" class="nav-item">
                    <i class="bi bi-telephone-fill"></i> VoLTE Calls
                </a>
            </nav>
            <div class="sidebar-footer p-4 text-xs opacity-50">
                <small>v2.1.0 Enhanced</small>
            </div>
        </aside>

        <!-- Navbar -->
        <header class="app-navbar">
            <button class="menu-toggle d-md-none" id="sidebarToggle">
                <i class="bi bi-list"></i>
            </button>
            <a href="/" class="navbar-brand">FlowVisualizer</a>

            <div class="navbar-search">
                <i class="bi bi-search"></i>
                <input type="text" placeholder="Search jobs, sessions, IPs...">
            </div>

            <div class="navbar-actions">
                <button class="theme-toggle-btn" id="themeToggle" title="Toggle Theme">
                    <i class="bi bi-moon-fill"></i>
                </button>
                <div class="user-profile">
                    <!-- Placeholder -->
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="app-content">
            <!-- Upload Section -->
            <div class="card mb-6">
                <div class="card-header">
                    <span><i class="bi bi-cloud-upload me-2"></i> Upload PCAP</span>
                </div>
                <div class="card-body">
                    <div id="dropZone" class="drop-zone">
                        <div class="drop-zone-content">
                            <i class="bi bi-cloud-arrow-up" style="font-size: 3rem; color: var(--color-primary);"></i>
                            <h4>Drag & Drop PCAP File Here</h4>
                            <p>or click to browse</p>
                            <button type="button" class="btn btn-primary" id="browseBtn">
                                <i class="bi bi-folder2-open"></i> Browse Files
                            </button>
                            <input type="file" id="fileInput" accept=".pcap,.pcapng,.cap" style="display: none;">
                        </div>
                        <div class="drop-zone-uploading" style="display: none;">
                            <div class="progress-bar-container"
                                style="height: 6px; background: var(--bg-tertiary); border-radius: 3px; overflow: hidden; margin: 1rem 0;">
                                <div id="uploadProgress"
                                    style="width: 0%; height: 100%; background: var(--color-primary); transition: width 0.3s;">
                                </div>
                            </div>
                            <p class="mt-2 text-secondary">
                                <span id="uploadFileName"></span> - <span id="uploadSize"></span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Jobs -->
            <div class="card">
                <div class="card-header">
                    <span><i class="bi bi-list-task me-2"></i> Recent Jobs</span>
                    <div class="actions flex gap-2">
                        <button class="btn btn-outline btn-sm text-error" id="bulkDeleteBtn" disabled>
                            <i class="bi bi-trash"></i> Delete Selected (0)
                        </button>
                        <button class="btn btn-outline btn-sm" id="refreshJobsBtn">
                            <i class="bi bi-arrow-clockwise"></i>
                        </button>
                    </div>
                </div>
                <div class="card-body p-0">
                    <!-- Jobs Table Container -->
                    <div class="data-table-container border-0">
                        <table class="data-table" id="jobsTable">
                            <thead>
                                <tr>
                                    <th class="w-10"><input type="checkbox" id="selectAll"></th>
                                    <th data-sort="status">Status <i
                                            class="bi bi-arrow-down-up text-muted opacity-25"></i></th>
                                    <th data-sort="job_id">Job ID <i
                                            class="bi bi-arrow-down-up text-muted opacity-25"></i></th>
                                    <th data-sort="input_filename">File <i
                                            class="bi bi-arrow-down-up text-muted opacity-25"></i></th>
                                    <th data-sort="session_count" class="text-center">Sessions <i
                                            class="bi bi-arrow-down-up text-muted opacity-25"></i></th>
                                    <th data-sort="created_at">Created <i class="bi bi-arrow-down text-primary"></i>
                                    </th> <!-- Default sort -->
                                    <th class="text-right">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="jobsTableBody">
                                <tr>
                                    <td colspan="7" class="text-center p-4">
                                        No jobs yet. Upload a PCAP file to get started.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" style="position: fixed; bottom: 20px; right: 20px; z-index: 1000;"></div>

    <!-- Scripts -->
    <!-- Bootstrap Bundle for modal and some utilities -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Core -->
    <script src="/js/theme.js"></script>
    <script src="/js/keyboard-nav.js"></script>
    <script src="/js/components/toast.js"></script>
    <script src="/js/app.js"></script>

    <!-- Components -->
    <script src="/js/components/protocol-badge.js"></script>
    <script src="/js/components/status-badge.js"></script>
    <script src="/js/components/session-card.js"></script>
    <script src="/js/components/pagination.js"></script>
    <script src="/js/components/data-table.js"></script>
    <script src="/js/components/modal.js"></script>

    <!-- Page Logic -->
    <script src="/js/uploader.js"></script>
    <script src="/js/websocket.js"></script>
    <script src="/js/pages/dashboard.js"></script>

    <script>
        // Sidebar Toggle
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebar = document.getElementById('sidebar');
        if (sidebarToggle && sidebar) {
            sidebarToggle.addEventListener('click', () => {
                sidebar.classList.toggle('show');
            });
            document.addEventListener('click', (e) => {
                if (window.innerWidth <= 768 && sidebar.classList.contains('show') && !sidebar.contains(e.target) && !sidebarToggle.contains(e.target)) {
                    sidebar.classList.remove('show');
                }
            });
        }
    </script>
</body>

</html>